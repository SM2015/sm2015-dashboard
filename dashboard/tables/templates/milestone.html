{% extends 'base_logado.html' %}
{% load staticfiles %}
{% load humanize %}

{% block js_bottom %}
    {{ block.super }}
    <script src="{% static "assets/plugins/jquery-slider/jquery.sidr.min.js" %}" type="text/javascript"></script>
    <script src="{% static "assets/plugins/jquery-numberAnimate/jquery.animateNumbers.js" %}" type="text/javascript"></script>
    <script src="{% static "assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js" %}" type="text/javascript"></script>
    <script src="{% static "assets/plugins/bootstrap-select2/select2.min.js" %}" type="text/javascript"></script>
    <script src="{% static "assets/plugins/jquery-datatable/js/jquery.dataTables.min.js" %}" type="text/javascript" ></script>
    <script src="{% static "assets/plugins/jquery-datatable/extra/js/TableTools.min.js" %}" type="text/javascript" ></script>
    <script type="text/javascript" src="{% static "assets/plugins/datatables-responsive/js/datatables.responsive.js" %}"></script>
    <script type="text/javascript" src="{% static "assets/plugins/datatables-responsive/js/lodash.min.js" %}"></script>
    <script src="{% static "assets/js/datatables.js" %}" type="text/javascript"></script>
    <script>
        $(document).ready(function() {
            $(window).bind("select-country", function(elem, country, country_slug){
                $(".country-name").text(country);

                $(".dataTables_wrapper").attr("style", "display: none !important");
                $("#hito-pais-"+country_slug+"_wrapper").attr("style", "display: block !important");

                $(".avance-pais").attr("style", "display: none !important");
                $(".avance-pais-"+country_slug).attr("style", "display: block !important");
            });
            $("select[name='select-pais']").change(function(){
                var name = $(this).find(":selected").val().split('|')[0];
                var slug = $(this).find(":selected").val().split('|')[1];
                $(window).trigger("select-country", [name, slug]);
            });

            {% for table in tables %}
                    var responsiveHelper = undefined;
                    var breakpointDefinition = {
                        tablet: 1024,
                        phone : 480
                    };
                    var tableElement_{{forloop.counter}} = $('#hito-pais-{{table.country.name|slugify}}');
                    tableElement_{{forloop.counter}}.dataTable( {
                        "sDom": "<'row-fluid'<'span6'l T><'span6'f>r>t<'row-fluid'<'span12'p i>>",
                            "oTableTools": {
                            "aButtons": [
                                {
                                    "sExtends":    "collection",
                                    "sButtonText": "<i class='icon-cloud-download'></i>",
                                    "aButtons":    [ "csv", "xls", "pdf", "copy"]
                                }
                            ]
                        },
                        "sPaginationType": "bootstrap",
                         "aoColumnDefs": [
                          { 'bSortable': false, 'aTargets': [ 0 ] }
                        ],
                        "aaSorting": [[ 1, "asc" ]],
                        "oLanguage": {
                            "sLengthMenu": "_MENU_ ",
                            "sInfo": "Showing <b>_START_ to _END_</b> of _TOTAL_ entries"
                        },
                         bAutoWidth     : false,
                        fnPreDrawCallback: function () {
                            // Initialize the responsive datatables helper once.
                            if (!responsiveHelper) {
                                responsiveHelper = new ResponsiveDatatablesHelper(tableElement_{{forloop.counter}}, breakpointDefinition);
                            }
                        },
                        fnRowCallback  : function (nRow) {
                            responsiveHelper.createExpandIcon(nRow);
                        },
                        fnDrawCallback : function (oSettings) {
                            responsiveHelper.respond();
                        }
                    });
                    
                    $('#hito-pais-{{table.country.name|slugify}} input').click( function() {
                        $(this).parent().parent().parent().toggleClass('row_selected');
                    });
            {% endfor %}
            
            {% if countries|length > 1 %}
            var $pais_initial = $("select[name='select-pais'] :selected");
            var name = $pais_initial.val().split('|')[0];
            var slug = $pais_initial.val().split('|')[1];
            $(window).trigger("select-country", [name, slug]);
            {% else %}
            $(window).trigger("select-country", ["{{countries.0.name}}", "{{countries.0.name|slugify}}"]);
            {% endif %}


            $('.editable.charfield').editable("{% url 'save_milestone_data' %}", { 
                height : 27,
                submitdata : function(value, settings) { 
                    return {
                        csrfmiddlewaretoken : "{{ csrf_token }}",
                        objid : $(this).parent().attr('id'),
                        objfield : $(this).attr('name')
                    };
                 }
            });

            
            var estados_actuais_options = {};
            $.getJSON("{% url 'list_estado_actual' %}", function(data){
                $.each(data, function(){
                    estados_actuais_options[this.name] = this.name;
                });
            });

            $('.editable.textfield').editable("{% url 'save_milestone_data' %}", { 
                type      : 'textarea',
                cancel    : 'Cancel',
                submit    : 'OK',
                submitdata : function(value, settings) { 
                    return {
                        csrfmiddlewaretoken : "{{ csrf_token }}",
                        objid : $(this).parent().attr('id'),
                        objfield : $(this).attr('name')
                    };
                 }
            });

            $('.editable.combofield.estado_actual').editable("{% url 'save_milestone_data' %}", { 
                type      : 'select',
                cancel    : 'Cancel',
                submit    : 'OK',
                data      : estados_actuais_options,
                submitdata : function(value, settings) { 
                    return {
                        csrfmiddlewaretoken : "{{ csrf_token }}",
                        objid : $(this).parent().attr('id'),
                        objfield : $(this).attr('name')
                    };
                 }
            });
        });
    </script>
{% endblock js_bottom %}

{% block css %}
    {{ block.super }}
    <style>
        .title-select-pais { 
            float: left;
        }
        .select-pais {
            float: left;
            margin: 5px 0 10px 10px;
        }

        .table-avances {}
        .table-avances .avances-header {
            background-color: #ECF0F2;
            border-bottom: 1px solid #DDDDDD;
            padding: 10px;
            text-align: right;
            width: 340px;
        }
        .table-avances .avances-value {
            border-bottom: 1px solid #EEEEEE;
            padding: 5px 20px;
        }
        .editable.combofield select {
            font-size: 13px;
            width: 85px;
        }
        button {
            background-color: #D1DADE;
            background-image: none !important;
            border: medium none;
            box-shadow: none;
            color: #5E5E5E;
            cursor: pointer;
            display: inline-block;
            font: 10px/20px "Helvetica Neue",Helvetica,Arial,sans-serif;
            margin: 5px 2px 0 0;
            padding: 3px 8px 4px;
            text-align: center;
            text-shadow: none;
            transition: all 0.12s linear 0s !important;
            vertical-align: middle;
        }
    </style>
{% endblock css %}

{% block content %}

<div class="content">
    <div class="row-fluid">
      <div class="span12">
        <div class="grid simple ">
          <div class="grid-body ">
            <div class="row-fluid clearfix">
                {% if countries|length > 1 %}
                <h4 class="title-select-pais">Seleccione un país - </h4>
                <select name="select-pais" class="select-pais">
                    {% for country in countries %}
                    <option value="{{country.name}}|{{country.name|slugify}}">{{country.name}}</option>
                    {% endfor %}
                </select>
                {% else %}
                <h4>Usted está viendo - <span class="semi-bold country-name"></span></h4>
                {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>


    <div class="row-fluid">
      <div class="span12">
        <div class="grid simple ">
          <div class="grid-title">
            <h4>Avance fisico financieros</h4>
            <div class="tools"> <a href="javascript:;" class="collapse"></a> <a href="#grid-config" data-toggle="modal" class="config"></a> <a href="javascript:;" class="reload"></a> <a href="javascript:;" class="remove"></a> </div>
          </div>
          <div class="grid-body ">
            {% for table in tables %}
            <div class="row-fluid column-seperation avance-pais avance-pais-{{table.country.name|slugify}}">
                {% for avance in table.avances %}
                <div class="span6">
                    <table class="table-avances table-bordered">
                        <tr>
                            <th class="avances-header">Cual es la fecha en que la información que está registrando fue actualizada</th>
                            <td class="avances-value">{{avance.fecha_de_actualizacion}}</td>
                        </tr>
                        <tr>
                            <th class="avances-header">Avances Fiscos Planificados (Meta Ejecución)</th>
                            <td class="avances-value">{{avance.avance_fisico_planificado}}%</td>
                        </tr>
                        <tr>
                            <th class="avances-header">Avances financieros  planificados (Ejecución financiera planificados)</th>
                            <td class="avances-value">{{avance.avance_financiero_planificado}}%</td>
                        </tr>
                        <tr>
                            <th class="avances-header">Monto total desembolsado (BID a PAIS)</th>
                            <td class="avances-value">${{avance.monto_desembolsado|intcomma}}</td>
                        </tr>
                        <tr>
                            <th class="avances-header">Avances Físicos reales (Avance en la ejecución real segun el PEP)</th>
                            <td class="avances-value">{{avance.avance_fisico_real}}%</td>
                        </tr>
                        <tr>
                            <th class="avances-header">Avances financieros actuales (Ejecución financiera real según el estados financieros del ejecutor hasta la fecha (%))</th>
                            <td class="avances-value">{{avance.avance_financiero_actual}}%</td>
                        </tr>
                    </table>
                </div>
                <div class="span6">
                    <table class="table-avances table-bordered">
                        <tr>
                            <th class="avances-header">Monto Comprometido</th>
                            <td class="avances-value">${{avance.monto_comprometido|intcomma}}</td>
                        </tr>
                        <tr>
                            <th class="avances-header">Avances Fiscos Planificados (Meta Ejecución): DE LA LINEA DE BASE ORIGINAL</th>
                            <td class="avances-value">{{avance.avances_fisicos_original_programado}}%</td>
                        </tr>
                        <tr>
                            <th class="avances-header">Avances financieros planificados (Ejecución financiera planificados) DEL LINEA DE BASE ORIGINAL</th>
                            <td class="avances-value">{{avance.avances_financieros_original_programado}}%</td>
                        </tr>
                        <tr>
                            <th class="avances-header">Alertas temprana en general</th>
                            <td class="avances-value">{{avance.alerta}}</td>
                        </tr>
                        <tr>
                            <th class="avances-header">Recomendaciones</th>
                            <td class="avances-value">{{avance.recomendacion}}</td>
                        </tr>
                    </table>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <div class="row-fluid">
      <div class="span12">
        <div class="grid simple ">
          <div class="grid-title">
            <h4>Hitos</h4>
            <div class="tools"> <a href="javascript:;" class="collapse"></a> <a href="#grid-config" data-toggle="modal" class="config"></a> <a href="javascript:;" class="reload"></a> <a href="javascript:;" class="remove"></a> </div>
          </div>
          <div class="grid-body ">
            <div class="row-fluid">
              {% for table in tables %}
              <table class="table table-hover table-condensed table-bordered" id="hito-pais-{{table.country.name|slugify}}">
                <thead>
                  <tr>
                    <th class="column-name">Indicador de Pago</th>
                    <th class="column-name">Hito</th>
                    <th class="column-name">Trimestre</th>
                    <th class="column-name">Audiencia</th>
                    <th class="column-name">Estado Actual</th>
                    <th class="column-name">Alerta/Notas</th>
                    <th class="column-name">Recomendación</th>
                    <th class="column-name">Acuerdo</th>
                    <th class="column-name">Actividad en POA</th>
                  </tr>
                </thead>
                <tbody>
                  {% for hito in table.hitos %}
                  <tr>
                    <td class="" name="indicador_de_pago">{{hito.indicador_de_pago}}</td>
                    <td class="" name="hito">{{hito.hito}}</td>
                    <td class="" name="trimestre">{{hito.trimestre}}</td>
                    <td class="" name="audiencia">
                        {{hito.audiencia.all|join:", "}}</td>
                    <td class="editable combofield estado_actual" name="estado_actual">{{hito.estado_actual.name}}</td>
                    <td class="editable textfield" name="alerta_notas">{{hito.alerta_notas}}</td>
                    <td class="editable textfield" name="recomendacion">{{hito.recomendacion}}</td>
                    <td class="editable textfield" name="acuerdo">{{hito.acuerdo}}</td>
                    <td class="editable charfield" name="actividad_en_pod">{{hito.actividad_en_poa}}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
</div>









<!--
<style>
    table.table {
        background-color: #FFFFFF;
    }
    .table-condensed th, .table-condensed td {
        padding: 10px 5px 10px 3px;
    }
    #example_paginate {
        display: none;
    }
    #example_info {
        margin-bottom:10px;
    }
</style>
<div class="content">
    <div class="row-fluid">
        <div class="span12">
            <div class="grid simple ">
                <div class="grid-body clearfix">
                    <div class="opcoes-paises">
                        {% if countries|length == 1 %}
                        <span>Pais: {{countries.0.name}}</span>
                        {% elif countries|length > 1 %}
                        <span>Pais:</span>
                        <select id="choice-country">
                            {% for country in countries %}
                            <option value="{{country.id}}">{{country.name}}</option>
                            {% endfor %}
                        </select>
                        {% endif %}
                    </div>

                    <table id="example" class="table table-hover table-condensed dataTable">
                        <thead>
                            <tr>
                            </tr>
                        </thead>
                        <tbody>
                        {% for hito in hitos %}
                        <tr id="hito-{{hito.id}}">
                            <td class="editable" name="indicador_de_pago">{{hito.indicador_de_pago}}<td>
                            <td class="editable" name="hito">{{hito.hito}}<td>
                            <td class="editable" name="trimestre">{{hito.trimestre}}<td>
                            <td class="editable" name="audiencia">{{hito.audiencia}}<td>
                            <td class="editable" name="estado_actual">{{hito.estado_actual}}<td>
                            <td class="editable" name="alerta_notas">{{hito.alerta_notas}}<td>
                            <td class="editable" name="recomendacion">{{hito.recomendacion}}<td>
                            <td class="editable" name="acuerdo">{{hito.acuerdo}}<td>
                            <td class="editable" name="actividad_en_pod">{{hito.actividad_en_pod}}<td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>    
            </div>    
        </div>    
    </div>    
</div>    
    <script type="text/javascript" charset="utf-8">
    /* Time between each scrolling frame */
    $.fn.dataTableExt.oPagination.iTweenTime = 100;

    $.fn.dataTableExt.oPagination.scrolling = {
        "fnInit": function ( oSettings, nPaging, fnCallbackDraw )
        {
            var oLang = oSettings.oLanguage.oPaginate;
            var oClasses = oSettings.oClasses;
            var fnClickHandler = function ( e ) {
                if ( oSettings.oApi._fnPageChange( oSettings, e.data.action ) )
                {
                    fnCallbackDraw( oSettings );
                }
            };

            var sAppend = (!oSettings.bJUI) ?
                '<a class="'+oSettings.oClasses.sPagePrevDisabled+'" tabindex="'+oSettings.iTabIndex+'" role="button">'+oLang.sPrevious+'</a>'+
                '<a class="'+oSettings.oClasses.sPageNextDisabled+'" tabindex="'+oSettings.iTabIndex+'" role="button">'+oLang.sNext+'</a>'
                :
                '<a class="'+oSettings.oClasses.sPagePrevDisabled+'" tabindex="'+oSettings.iTabIndex+'" role="button"><span class="'+oSettings.oClasses.sPageJUIPrev+'"></span></a>'+
                '<a class="'+oSettings.oClasses.sPageNextDisabled+'" tabindex="'+oSettings.iTabIndex+'" role="button"><span class="'+oSettings.oClasses.sPageJUINext+'"></span></a>';
            $(nPaging).append( sAppend );
            
            var els = $('a', nPaging);
            var nPrevious = els[0],
                nNext = els[1];
            
            oSettings.oApi._fnBindAction( nPrevious, {action: "previous"}, function() {
                /* Disallow paging event during a current paging event */
                if ( typeof oSettings.iPagingLoopStart != 'undefined' && oSettings.iPagingLoopStart != -1 )
                {
                    return;
                }
                
                oSettings.iPagingLoopStart = oSettings._iDisplayStart;
                oSettings.iPagingEnd = oSettings._iDisplayStart - oSettings._iDisplayLength;
                
                /* Correct for underrun */
                if ( oSettings.iPagingEnd < 0 )
                {
                  oSettings.iPagingEnd = 0;
                }
                
                var iTween = $.fn.dataTableExt.oPagination.iTweenTime;
                var innerLoop = function () {
                    if ( oSettings.iPagingLoopStart > oSettings.iPagingEnd ) {
                        oSettings.iPagingLoopStart = oSettings.iPagingLoopStart-1;
                        oSettings._iDisplayStart = oSettings.iPagingLoopStart;
                        fnCallbackDraw( oSettings );
                        setTimeout( function() { innerLoop(); }, iTween );
                    } else {
                        oSettings.iPagingLoopStart = -1;
                    }
                };
                innerLoop();
            } );

            oSettings.oApi._fnBindAction( nNext, {action: "next"}, function() {
                /* Disallow paging event during a current paging event */
                if ( typeof oSettings.iPagingLoopStart != 'undefined' && oSettings.iPagingLoopStart != -1 )
                {
                    return;
                }
                
                oSettings.iPagingLoopStart = oSettings._iDisplayStart;
                
                /* Make sure we are not over running the display array */
                if ( oSettings._iDisplayStart + oSettings._iDisplayLength < oSettings.fnRecordsDisplay() )
                {
                    oSettings.iPagingEnd = oSettings._iDisplayStart + oSettings._iDisplayLength;
                }
                
                var iTween = $.fn.dataTableExt.oPagination.iTweenTime;
                var innerLoop = function () {
                    if ( oSettings.iPagingLoopStart < oSettings.iPagingEnd ) {
                        oSettings.iPagingLoopStart++;
                        oSettings._iDisplayStart = oSettings.iPagingLoopStart;
                        fnCallbackDraw( oSettings );
                        setTimeout( function() { innerLoop(); }, iTween );
                    } else {
                        oSettings.iPagingLoopStart = -1;
                    }
                };
                innerLoop();
            } );
        },
        
        "fnUpdate": function ( oSettings, fnCallbackDraw )
        {
            if ( !oSettings.aanFeatures.p )
            {
                return;
            }
            
            /* Loop over each instance of the pager */
            var an = oSettings.aanFeatures.p;
            for ( var i=0, iLen=an.length ; i<iLen ; i++ )
            {
                if ( an[i].childNodes.length !== 0 )
                {
                    an[i].childNodes[0].className = 
                        ( oSettings._iDisplayStart === 0 ) ? 
                        oSettings.oClasses.sPagePrevDisabled : oSettings.oClasses.sPagePrevEnabled;
                    
                    an[i].childNodes[1].className = 
                        ( oSettings.fnDisplayEnd() == oSettings.fnRecordsDisplay() ) ? 
                        oSettings.oClasses.sPageNextDisabled : oSettings.oClasses.sPageNextEnabled;
                }
            }
        }
    }
            
            $(document).ready(function() {
                $('#example').dataTable({});
            });
        
    </script>

-->
{% endblock %}
